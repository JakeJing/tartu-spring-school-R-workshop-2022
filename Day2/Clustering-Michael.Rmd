---
title: "Data clustering with PCA"
output: html_notebook
---

Michael Dunn, 6th of April 2022

<!-- 14.30 - 15:30 *Data clustering with Principal Components Analysis (PCA)* --> 

- Revision of previous lesson (to be decided)
- More on `pivot_wider()` and `pivot_longer()`

## Principal components analysis

- Works from wide data: rows are taxa (languages, species, individuals, etc), and columns are features (typological states, other types of measurement)

```{r message=FALSE}
values <- read_csv("../data/values.csv")  %>%
  filter(grepl("UT", Parameter_ID)) %>%
  mutate(Value=as.integer(Value)) %>%
  pivot_wider(Language_ID, names_from=Parameter_ID, values_from=Value) 
#values
languages <- read_csv("../data/languages.csv") %>% select(Name, Language_ID=ID)
#languages
languages %>%
  inner_join(values) %>%
  select(-Language_ID) ->
  uratyp_data
```
```{r}
#language_names <- uratyp_data$Name 
#uratyp_data <- as.data.frame(uratyp_data %>% select(-Name))
#row.names(uratyp_data) <- language_names
uratyp_data <- uratyp_data %>% column_to_rownames("Name")
```


```{r}
library(janitor)
# uratyp_data[is.na(uratyp_data)] <- 0.5 # :-(
uratyp_data %>% 
  select_if(function(x) !any(is.na(x)))  %>%
  remove_constant() %>%
  prcomp() ->
  uratyp_pca
```

```{r}
summary(uratyp_pca)
```
# Talk about prop of var explained

# graph uratyp_pca$x (with colour coding for Subfamily...) // https://osf.io/v4fhq/

Old school visualisation:
```{r}
biplot(uratyp_pca)
```

The pca object is a list with an attribute called (uninformatively) `x` which contains the values of the components.

```{r}
languages <- read_csv("../data/languages.csv") %>% select(Name, Subfamily)
uratyp_pca$x[,c("PC1", "PC2")] %>% 
  as.data.frame() %>% 
  rownames_to_column("Name") %>% 
  inner_join(languages) %>%
  ggplot(aes(x=PC1, y=PC2, label=Name, colour=Subfamily)) + geom_text()
```
Legend is ugly â€” we want to remove the "a" text examples, and put the subfamily labels directly in the target colour. This can be done, but it's currently quite complicated. Instead we can just zap it:

```{r}
languages <- read_csv("../data/languages.csv") %>% select(Name, Subfamily)
uratyp_pca$x[,c("PC1", "PC2")] %>% 
  as.data.frame() %>% 
  rownames_to_column("Name") %>% 
  inner_join(languages) %>%
  ggplot(aes(x=PC1, y=PC2, label=Name, colour=Subfamily)) + 
    geom_text() +
    theme(legend.position = "none")
```
